(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-09693dd8","chunk-2d21062b","chunk-b5d27614","chunk-04bac318","chunk-704b369c","chunk-6b46fcb4","chunk-2d21062b"],{"2f21":function(e,t,i){"use strict";var r=i("79e5");e.exports=function(e,t){return!!e&&r((function(){t?e.call(null,(function(){}),1):e.call(null)}))}},"4de5":function(e,t,i){"use strict";i.r(t),i.d(t,"getPfmcEvalById",(function(){return s})),i.d(t,"addPfmcEvaluate",(function(){return o}));var r=i("b775"),a=i("b854");function s(e){return Object(r["a"])({url:"".concat(a["pfmcExecution"],"/pfmcEval/getPfmcEvalById/").concat(e),method:"get"})}function o(e){return Object(r["a"])({url:"".concat(a["pfmcExecution"],"/pfmcEval"),method:"post",data:e})}},"55dd":function(e,t,i){"use strict";var r=i("5ca1"),a=i("d8e8"),s=i("4bf8"),o=i("79e5"),l=[].sort,n=[1,2,3];r(r.P+r.F*(o((function(){n.sort(void 0)}))||!o((function(){n.sort(null)}))||!i("2f21")(l)),"Array",{sort:function(e){return void 0===e?l.call(s(this)):l.call(s(this),a(e))}})},af49:function(e,t,i){"use strict";var r=i("e668"),a=i.n(r);a.a},b854:function(e,t,i){"use strict";i.r(t),i.d(t,"pfmcSettings",(function(){return r})),i.d(t,"pfmcAsist",(function(){return a})),i.d(t,"pfmcExecution",(function(){return s})),i.d(t,"pfmcEval",(function(){return o}));var r="pfmc-settings",a="pfmc-asist",s="pfmc-execution",o="pfmc-eval"},bf20:function(e,t,i){"use strict";i.r(t),i.d(t,"listPfmcparam",(function(){return s})),i.d(t,"addPfmcParams",(function(){return o})),i.d(t,"savePfmcParams",(function(){return l})),i.d(t,"getParam",(function(){return n}));var r=i("b775"),a=i("b854");function s(e){return Object(r["a"])({url:"".concat(a["pfmcSettings"],"/pfmcparams/list"),method:"post",data:e})}function o(e){return Object(r["a"])({url:"".concat(a["pfmcSettings"],"/pfmcparams/add"),method:"post"})}function l(e){return Object(r["a"])({url:"".concat(a["pfmcSettings"],"/pfmcparams/update"),method:"put",data:e})}function n(e){return Object(r["a"])({url:"".concat(a["pfmcSettings"],"/pfmcparams/getParam"),method:"get",params:e})}},dca5:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("workflow-page",{ref:"wfpage",attrs:{"flow-params":e.flowParams,"approver-map":e.approverMap,vars:e.vars},on:{"driven-flow":e.drivenFlow}},[i("div",{staticClass:"app-container"},[i("el-form",{staticStyle:{"margin-bottom":"30px"}},[i("el-row",[i("el-col",{attrs:{span:8}},[i("span",{staticStyle:{"font-weight":"bold"}},[e._v("被考核人信息")])])],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"员工编号："}},[i("span",[e._v(e._s(e.evalEmp.empNumber))])])],1),e._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"姓名："}},[i("span",[e._v(e._s(e.evalEmp.empName))])])],1),e._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"部门："}},[i("span",[e._v(e._s(e.evalEmp.orgName))])])],1)],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"考核期间："}},[i("span",[e._v(e._s(e.periodName))])])],1),e._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"考核打分人："}},[i("span",[e._v(e._s(e.evalPersonShow))])])],1),e._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"打分方式："}},[i("span",[e._v(e._s(e.scoreModeName))])])],1)],1)],1),e._v(" "),i("el-form",{attrs:{inline:!0,"label-width":"120px"}},[i("el-collapse",{ref:"previewContain",staticStyle:{width:"100%","border-bottom":"1"},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.itemSectionList,(function(t,r){return i("el-collapse-item",{key:t.formSectionId,staticStyle:{width:"100%"},attrs:{name:r}},[i("template",{slot:"title"},[i("div",{staticStyle:{width:"100%"},on:{click:function(e){}}},[i("div",{staticStyle:{float:"left","margin-top":"13px",width:"150px","font-weight":"bold"}},[e._v(e._s(t.sectionName)+"\n                ")]),e._v(" "),e.isHasGroupHeight(t)?i("div",{staticStyle:{float:"right","margin-left":"10px","margin-top":"15px",width:"250px"}},[i("el-form-item",{attrs:{label:"组间权重"}},[i("el-input",{staticStyle:{margin:"5px 0 0 0",width:"50px","line-height":"20px",height:"20px"},attrs:{disabled:!0},model:{value:t.wt,callback:function(i){e.$set(t,"wt",i)},expression:"apply.wt"}}),i("span",[e._v("%")])],1)],1):e._e()])]),e._v(" "),i("div",{staticStyle:{width:"100%"}},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,"row-key":e.getRowKeys,"expand-row-keys":e.expands,"tree-props":{children:"children",hasChildren:"hasChildren"},"empty-text":" ","show-summary":!0,"summary-method":e.getGroupSum},on:{"current-change":e.toggleRowExpansion}},[i("el-table-column",{attrs:{label:"序号",type:"index"}}),e._v(" "),e._l(t.itemFieldList,(function(t,r){return e.isShowColumn(t)?i("el-table-column",{key:r,attrs:{prop:t.prop,width:t.width,label:t.fieldName,"show-overflow-tooltip":!0,align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return["select"===t.fieldType&&r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v("\n                        "+e._s(r.row[t.prop].itemValue)+"\n                      ")]:[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}},e._l(t.selectValue,(function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})})),1)]],2):"date"===t.fieldType&&r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v("\n                        "+e._s(r.row[t.prop].itemValue)+"\n                      ")]:[i("el-date-picker",{staticStyle:{width:"100%",height:"100%","line-height":"100%"},attrs:{type:"date",placeholder:"选择日期"},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}})]],2):r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v("\n                        "+e._s(r.row[t.prop].itemValue)+"\n                      ")]:[i("el-input",{staticStyle:{width:"100%",height:"100%","line-height":"100%"},attrs:{type:"textarea"},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}})]],2):e._e()]}}],null,!0)}):e._e()})),e._v(" "),0==e.widthPerIsShow?i("el-table-column",{attrs:{type:"expand",align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[i("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[e._l(t.expendFieldList,(function(t,a){return[i("el-row",[e.isShowColumn(t,!1)?i("el-form-item",{attrs:{label:t.fieldName,prop:t.prop}},["select"===t.fieldType&&r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v("\n                                "+e._s(r.row[t.prop].itemValue)+"\n                              ")]:[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}},e._l(t.selectValue,(function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})})),1)]],2):"date"===t.fieldType&&r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v("\n                                "+e._s(r.row[t.prop].itemValue)+"\n                              ")]:[i("el-date-picker",{staticStyle:{width:"100%",height:"100%","line-height":"100%"},attrs:{type:"date",placeholder:"选择日期"},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}})]],2):r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v("\n                                "+e._s(r.row[t.prop].itemValue)+"\n                              ")]:[i("el-input",{staticStyle:{width:"100%",height:"100%","line-height":"100%"},attrs:{type:"textarea",disabled:e.isDisableColumn(t)},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}})]],2):e._e()]):e._e()],1)]}))],2)]}}],null,!0)}):e._e()],2)],1)],2)})),1),e._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.finalScoreRowData,"show-header":!1}},[i("el-table-column",{attrs:{prop:"idx",width:"48"}}),e._v(" "),e.isShowPage?i("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[i("b",[e._v("最终得分：")]),e._v(" "+e._s(t.row.score)+"\n           ")]}}],null,!1,3722987733)}):e._e(),e._v(" "),i("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("合计总分：")]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",width:e.finalScoreRowData[0].selfWidth},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n             自评分"),i("br"),e._v(e._s(t.row.selfScore)+"\n           ")]}}])}),e._v(" "),e._l(e.evalPersonList,(function(t,r){return e.isShowTotalScore(r)?i("el-table-column",{key:r,attrs:{align:"center",width:e.finalScoreRowData[0]["scoreWidth"+(r+1)]},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n             领导"+e._s(r+1)+"评分"),i("br"),e._v(e._s(t.row["score"+(r+1)])+"\n           ")]}}],null,!0)}):e._e()}))],2)],1)],1)])},a=[],s=(i("96cf"),i("3b8d")),o=(i("55dd"),i("28a5"),i("7f7f"),i("3b2b"),i("c5f6"),i("ac6a"),i("b775")),l=i("c1df"),n=i.n(l),c=i("b854"),m=i("4de5"),p=i("bf20"),u={props:{flowParams:Object},components:{WorkflowPage:function(){return i.e("chunk-654254cb").then(i.bind(null,"76d1"))}},data:function(){return{eval:{},procInstId:void 0,widthPerIsShow:!0,loading:!0,secGroupMap:{},formSetSectionList:[],itemSectionList:[],lastGroupFieldList:[],viewStage:void 0,evalEmp:{},evalPersonList:[],pfmcProgram:{},scoreModeName:"",loginEmp:{},pfmcEvaluate:{},approverMap:{},expands:[],vars:{},activeNames:[],evalPersonShow:void 0,isCopyScoreFlag:1,isOnlyShowCurLeader:!0,isShowPage:!1,periodName:void 0,isHaveEmpConfirm:!0,isNeedPublishScoreToView:!1,gradeAssessorId:void 0}},computed:{finalScoreRowData:function(){var e={idx:" "};e.score=this.pfmcEvaluate.score,e.selfScore=this.pfmcEvaluate.selfScore,e.selfWidth=this.scoreColWidthObj.selfWidth;for(var t=0,i=this.evalPersonList?this.evalPersonList.length:0;t<i;t++)e["score"+(t+1)]=this.pfmcEvaluate["score"+(t+1)],e["scoreWidth"+(t+1)]=this.scoreColWidthObj["scoreWidth"+this.evalPersonList[t].empId];var r=[];return r.push(e),r},scoreColWidthObj:function(){var e={};return this.itemSectionList.length<=0?e:(this.itemSectionList[this.itemSectionList.length-1].itemFieldList.forEach((function(t){"4"===t.otherAttr?e.selfWidth=t.width:"5"===t.otherAttr&&(e["scoreWidth"+t.prop]=t.width)})),e)}},created:function(){this.showPfmcTable()},methods:{toggleRowExpansion:function(e){this.expands=[],this.expands.push(e.rowId)},getRowKeys:function(e){return e.rowId},isShowTotalScore:function(e){if(this.isShowPage)return!0;var t=this.getCurItem(this.evalPersonList,this.loginEmp.empId,"empId"),i=t?t.inListIndex:-1;return this.isOnlyShowCurLeader?e==i:e<=i},isHasGroupHeight:function(e){return this.pfmcProgram.isHaveGroupWeight&&e&&"score"!=e.sectionType&&e.wt},isDisableColumn:function(e){if(this.isShowPage)return!0;var t=!1;return t="5"==e.otherAttr?this.loginEmp.empId!=e.prop||"2"==this.flowParams.taskType:e.viewStage<this.viewStage||"2"==this.flowParams.taskType,t},isShowColumn:function(e){if(this.isShowPage)return!0;var t=!1;if("5"==e.otherAttr)if(this.isOnlyShowCurLeader)t=this.loginEmp.empId==e.prop;else{var i=this.getCurItem(this.evalPersonList,this.loginEmp.empId,"empId"),r=i?i.inListIndex:-1,a=this.getCurItem(this.evalPersonList,e.prop,"empId"),s=a?a.inListIndex:-1;t=s<=r}else t=e.viewStage<=this.viewStage;return t},$_businessVaildCallBack:function(){for(var e=0;e<this.itemSectionList.length;e++){for(var t=this.itemSectionList[e],i=0;i<t.itemFieldList.length;i++){var r=t.itemFieldList[i];if("Y"===r.isnotnull&&this.isShowColumn(r)&&!this.isDisableColumn(r))for(var a=0;a<t.tableData.length;a++){var s=t.tableData[a];if(s[r.prop]&&!s[r.prop].itemValue)return this.$notify({title:r.fieldName+"不能为空",message:"",type:"error"}),!1}}for(var o=0;t.expendFieldList&&o<t.expendFieldList.length;o++){var l=t.expendFieldList[o];if("Y"===l.isnotnull&&this.isShowColumn(l)&&!this.isDisableColumn(l))for(var n=0;n<t.tableData.length;n++){var c=t.tableData[n];if(c[l.prop]&&!c[l.prop].itemValue)return this.$notify({title:l.fieldName+"不能为空",message:"",type:"error"}),!1}}}return!0},buildPfmcEvaluate:function(){for(var e={procInstId:this.procInstId,groupLists:[],selfScore:0,score1:0,score2:0,score3:0,score4:0,score:0,level:void 0},t=0;t<this.itemSectionList.length;t++){for(var i=this.itemSectionList[t],r={itemGroupId:i.groupId,itemRowList:[],selfScore:0,score1:0,score2:0,score3:0,score4:0},a=0;a<i.tableData.length;a++){var s=i.tableData[a],o={rowId:s.rowId,itemList:[]};for(var l in s){if("4"===s[l].otherAttr){var n=parseFloat(s[l].itemValue||0,this.pfmcProgram.decimalPlace||2);if(!isNaN(n))if("weight"===this.pfmcProgram.scoreMode)r.selfScore+=n;else{var c=this.getItemFromObj(s,"3","otherAttr");if(c){var m=parseInt(c.itemValue);r.selfScore+=n*m/100}else r.selfScore+=n}}else if("5"===s[l].otherAttr){var p=parseFloat(s[l].itemValue||0,this.pfmcProgram.decimalPlace||2),u=this.getCurItem(this.evalPersonList,l,"empId");if(!isNaN(p))if("weight"===this.pfmcProgram.scoreMode)r["score"+(u.inListIndex+1)]+=p;else{var d=this.getItemFromObj(s,"3","otherAttr");if(d){var f=parseInt(d.itemValue);r["score"+(u.inListIndex+1)]+=p*f/100}else r["score"+(u.inListIndex+1)]+=p}}if("rowId"!=l){var h={itemId:s[l].itemId,itemValue:s[l].itemValue};o.itemList.push(h)}}r.itemRowList.push(o)}e.groupLists.push(r),this.isHasGroupHeight(i)?(e.selfScore+=r.selfScore*i.wt/100,e.score1+=r.score1*i.wt/100,e.score2+=r.score2*i.wt/100,e.score3+=r.score3*i.wt/100,e.score4+=r.score4*i.wt/100):(e.selfScore+=r.selfScore,e.score1+=r.score1,e.score2+=r.score2,e.score3+=r.score3,e.score4+=r.score4)}for(var v=0;v<this.evalPersonList.length;v++){var w=this.evalPersonList[v],g=w.weight;e.score+=e["score"+(v+1)]*g/100}return this.pfmcProgram.decimalPlace=parseInt(this.pfmcProgram.decimalPlace)||2,e.selfScore=this.switchDecimalPlace(e.selfScore,this.pfmcProgram.decimalPlace),e.score1=this.switchDecimalPlace(e.score1,this.pfmcProgram.decimalPlace),e.score2=this.switchDecimalPlace(e.score2,this.pfmcProgram.decimalPlace),e.score3=this.switchDecimalPlace(e.score3,this.pfmcProgram.decimalPlace),e.score4=this.switchDecimalPlace(e.score4,this.pfmcProgram.decimalPlace),e.score=this.switchDecimalPlace(e.score,this.pfmcProgram.decimalPlace),e},switchDecimalPlace:function(e,t){for(var i=1,r=0;r<t;r++)i*=10;return e=Math.round(e*i)/i,e},getGroupSum:function(e){var t=this,i=e.columns,r=e.data,a=[];return i.forEach((function(e,i){if(a[i]="0",0!==i){var s=r.map((function(t){return t[e.property]})),o=0;s.every((function(e){return e&&("4"===e.otherAttr||"5"===e.otherAttr)}))?(a[i]=r.reduce((function(i,r){o++;var a=0,l=t.getItemFromObj(r,"3","otherAttr"),n=l?parseInt(l.itemValue):null;if(t.verifyScore(r[e.property].itemValue,n,t.pfmcProgram.scoreMode,r[e.property].sectionType,r[e.property].decimalPlace)?a="weight"===t.pfmcProgram.scoreMode?Number(r[e.property].itemValue):n?Number(r[e.property].itemValue)*n/100:Number(r[e.property].itemValue):(r[e.property].itemValue="",a=0),o==s.length){var c=t.getCurItem(t.itemSectionList,r[e.property].formSectionId,"formSectionId"),m=t.isHasGroupHeight(c)?Number(c.wt):100;return isNaN(a)?t.switchDecimalPlace(Number(i)*m/100,t.pfmcProgram.decimalPlace):t.switchDecimalPlace((Number(i)+a)*m/100,t.pfmcProgram.decimalPlace)}return isNaN(a)?t.switchDecimalPlace(Number(i),t.pfmcProgram.decimalPlace):t.switchDecimalPlace(Number(i)+a,t.pfmcProgram.decimalPlace)}),0),a[i]+=""):s.every((function(e){return e&&"3"===e.otherAttr}))?(a[i]=s.reduce((function(e,t){var i=Number(t.itemValue);return isNaN(i)?e:e+i}),0),a[i]):a[i]=" "}else a[i]="合计"})),this.pfmcEvaluate=this.buildPfmcEvaluate(),a},verifyScore:function(e,t,i,r,a){a||(a="");var s=new RegExp("^([0-9])+(.)?(\\d{1,"+a+"})?$"),o=new RegExp("^(0){1}(.){1}(\\d{1,"+a+"})?$"),l=new RegExp("^((-)?([0-9])*(.)?(\\d{1,"+a+"})?)$"),n=new RegExp("^((-)?0{1}(.){1}(\\d{1,"+a+"})?)$");if("score"===r){if(!l.test(e)&&!n.test(e)&&e)return this.$notify({title:"请输入数字，且注意保留的小数位数",message:"",type:"error"}),!1}else if(!s.test(e)&&!o.test(e)&&e)return this.$notify({title:"请输入正数，且注意保留的小数位数",message:"",type:"error"}),!1;if("weight"===i&&"score"!=r){if(!t)return this.$notify({title:"无法获取权重",message:"",type:"error"}),!1;if(e>t)return this.$notify({title:"不能大于权重",message:"",type:"error"}),!1}else if("five"===i){if(e>5)return this.$notify({title:"当前打分方式为五分制",message:"",type:"error"}),!1}else if("ten"===i){if(e>10)return this.$notify({title:"当前打分方式为十分制",message:"",type:"error"}),!1}else if("hundred"===i&&e>100)return this.$notify({title:"当前打分方式为百分制",message:"",type:"error"}),!1;return!0},sortNumber:function(e,t){return parseInt(e.showOrder)-parseInt(t.showOrder)},getItemFromObj:function(e,t,i){var r=null;for(var a in e){var s=e[a];if(s&&s[i]===t){r=s;break}}return r},getCurItem:function(e,t,i){for(var r=null,a=0;e&&a<e.length;a++){var s=e[a];if(s[i]===t){r=s,r.inListIndex=a;break}}return r},buildHorizontalTitle:function(e,t){for(var i=[],r={titleFields:i},a=0,s=0;s<e.formSetFieldList.length;s++){var o=e.formSetFieldList[s],l={fieldName:o.fieldName,showOrder:o.showOrder,prop:"5"===o.otherAttr?o.empId:o.formFieldId,fieldType:o.fieldType,viewStage:parseInt(o.viewStage),selectValue:"select"===o.fieldType?o.selectValue.split(","):[],width:"1"==e.widthPerType?t*parseInt(o.widthper)/100:o.widthper,otherAttr:o.otherAttr,isnotnull:o.isnotnull,ishasfile:o.ishasfile};this.isShowColumn(l)&&(a+=l.width),i.push(l)}return i.sort(this.sortNumber),this.setColumnWidth(a,t,i),r},setColumnWidth:function(e,t,i){for(var r=.95*t/e,a=0;a<i.length;a++){var s=i[a];this.isShowColumn(s)&&(s.width=s.width*r+"px")}},buildVerticalTitle:function(e,t){for(var i=[],r=[],a={titleFields:i,expendFields:r},s=["2","3","4","5"],o=0;o<e.formSetFieldList.length;o++){var l=e.formSetFieldList[o],n={fieldName:l.fieldName,showOrder:l.showOrder,prop:"5"===l.otherAttr?l.empId:l.formFieldId,fieldType:l.fieldType,viewStage:parseInt(l.viewStage),selectValue:"select"===l.fieldType?l.selectValue.split(","):[],width:"1"==e.widthPerType?t*parseInt(l.widthper)/100:l.widthper+"px",otherAttr:l.otherAttr,isnotnull:l.isnotnull,ishasfile:l.ishasfile};s.indexOf(l.otherAttr)>=0?(i.push(n),this.isShowColumn(n)&&n.width):r.push(n)}return i.sort(this.sortNumber),r.sort(this.sortNumber),this.setColumnWidth(titleNum,t,i),a},buildTablelData:function(e,t){for(var i=[],r=0;e&&r<e.length;r++){var a=e[r],s=a?a.itemList:null,o={};o.rowId=a.rowId;for(var l=!1,c=0;c<t.formSetFieldList.length;c++){l=!1;var m=t.formSetFieldList[c];if("5"===m.otherAttr){var p=this.getCurItem(s,m.empId,"leaderEmpId");if(p){var u=p.itemId;o[m.empId]={},o[m.empId]["itemId"]=u,o[m.empId]["itemValue"]="date"===m.fieldType?n()(p.itemValue).format("YYYY-MM-DD"):p.itemValue,o[m.empId]["sectionType"]=t.sectionType,o[m.empId]["ishasfile"]=m.ishasfile,o[m.empId]["otherAttr"]=m.otherAttr,o[m.empId]["decimalPlace"]=m.decimalPlace,o[m.empId]["formSectionId"]=t.formSectionId,this.copyScore(this.loginEmp.empId,m.empId,o,this.evalPersonList,this.isCopyScoreFlag),l=!0}}else{var d=this.getCurItem(s,m.formFieldId,"formFieldId");if(d){var f=d.itemId;o[m.formFieldId]={},o[m.formFieldId]["itemId"]=f,o[m.formFieldId]["itemValue"]="date"===m.fieldType?n()(d.itemValue).format("YYYY-MM-DD"):d.itemValue,o[m.formFieldId]["otherAttr"]=m.otherAttr,o[m.formFieldId]["sectionType"]=t.sectionType,o[m.formFieldId]["ishasfile"]=m.ishasfile,o[m.formFieldId]["decimalPlace"]=m.decimalPlace,o[m.formFieldId]["formSectionId"]=t.formSectionId,l=!0}}}l&&i.push(o)}return i},copyScore:function(e,t,i,r,a){if(!this.isShowPage&&e===t)if("1"==a){var s=this.getItemFromObj(i,"4","otherAttr");i[t]["itemValue"]=s?s.itemValue:""}else if("2"==a){var o=this.getCurItem(r,e,"empId"),l=o?o.inListIndex:-1;if(l>0){var n=r[l-1],c=itemList[n.empId];i[t]["itemValue"]=c?c.itemValue:""}else{var m=this.getItemFromObj(i,"4","otherAttr");i[t]["itemValue"]=m?m.itemValue:""}}},buildItemList:function(e,t,i,r){var a=[];if(e&&0!=e.length){for(var s=0;s<e.length;s++){var o=e[s],l=t[o.formSectionId],n=l.itemRowList,c={sectionName:o.sectionName,sectionType:o.sectionType,formSectionId:o.formSectionId,showOrder:o.showOrder,itemFieldList:[],expendFieldList:[],tableData:[],groupId:l.itemGroupId,wt:l.wt};if(!o.formSetFieldList||0==o.formSetFieldList.length)break;var m=null;m=r?this.buildHorizontalTitle(o,i):this.buildVerticalTitle(o,i),c.itemFieldList=m.titleFields,c.expendFieldList=m.expendFields,c.tableData=this.buildTablelData(n,o),a.push(c),a.sort(this.sortNumber),this.activeNames.push(s)}return a}},showPfmcTable:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,i,r,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.fullScreenLoading("正在加载流程页面，请稍后……"),e.next=3,Object(p["getParam"])({paramName:"绩效考核流程是否含有员工确认环节"});case 3:return i=e.sent,this.isHaveEmpConfirm="Y"===i.data.paramValue,e.next=7,Object(p["getParam"])({paramName:"绩效分数是否发布后查看"});case 7:r=e.sent,this.isNeedPublishScoreToView="Y"===r.data.paramValue,this.procInstId=this.flowParams.PROC_INST_ID_,this.flowParams.TASK_DEF_KEY_.indexOf("EmpFillEval")>=0?this.viewStage=2:this.flowParams.TASK_DEF_KEY_.indexOf("ManAuditEval")>=0?this.viewStage=3:this.flowParams.TASK_DEF_KEY_.indexOf("EmpConfirm")>=0&&(this.viewStage=4,this.isShowPage=!0),Object(m["getPfmcEvalById"])(this.flowParams.PROC_INST_ID_).then((function(e){a.eval=e.data,a.evalEmp=a.eval.pfmcEmployee,a.evalPersonList=a.eval.evalPersonList,a.widthPerIsShow="1"===a.eval.showType,a.periodName=a.eval.cycleName,a.gradeAssessorId=a.eval.pfmcEvaluate.assessorId,a.loginEmp=a.eval.loginEmployee,a.pfmcProgram=a.eval.pfmcProgram,a.formSetSectionList=a.eval.fmSetSectionList;var i=a.$refs.previewContain.$el.offsetWidth;a.secGroupMap=a.eval.secGroupMap,a.itemSectionList=a.buildItemList(a.formSetSectionList,a.secGroupMap,i,a.widthPerIsShow)||[],a.lastGroupFieldList=a.itemSectionList[a.itemSectionList.length-1].itemFieldList,a.setLinkApproveMan(),a.setEvalPerson(),a.setScoreModeName(a.pfmcProgram.scoreMode),t.close()}));case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setScoreModeName:function(e){"five"===e?this.scoreModeName="五分制":"ten"===e?this.scoreModeName="十分制":"hundred"===e?this.scoreModeName="百分制":"weight"===e?this.scoreModeName="权重分制":this.$notify({title:"打分方式未设置，请联系管理员",message:"",type:"error"})},setEvalPerson:function(){for(var e=0;e<this.evalPersonList.length;e++){var t=this.evalPersonList[e];0==e?this.evalPersonShow=t.empName:this.evalPersonShow+=","+t.empName}},setLinkApproveMan:function(){var e={},t=null;"EmpConfirm"!==this.flowParams.TASK_DEF_KEY_&&("EmpFillEval"===this.flowParams.TASK_DEF_KEY_?(t=this.evalPersonList[0],this.approverMap["ManAuditEval1"]=e):"ManAuditEval1"===this.flowParams.TASK_DEF_KEY_?(t=this.evalPersonList[1],this.approverMap["ManAuditEval2"]=e):"ManAuditEval2"===this.flowParams.TASK_DEF_KEY_?(t=this.evalPersonList[2],this.approverMap["ManAuditEval3"]=e):"ManAuditEval3"===this.flowParams.TASK_DEF_KEY_&&(t=this.evalPersonList[3],this.approverMap["ManAuditEval4"]=e),t?(e.userName=t.empNumber,e.nickName=t.empName,this.vars["isEnd"]="0"):!this.isHaveEmpConfirm||this.isNeedPublishScoreToView||this.gradeAssessorId?this.vars["isEnd"]="2":(this.vars["isEnd"]="1",e.userName=this.evalEmp.empNumber,e.nickName=this.evalEmp.empName,this.approverMap["EmpConfirm"]=e))},drivenFlow:function(e,t){var i=this;this.pfmcEvaluate=this.buildPfmcEvaluate(),t["pfmcEval"]=this.pfmcEvaluate;var r=this.fullScreenLoading("正在驱动流程，请稍后……");Object(o["a"])({url:"".concat(c["pfmcExecution"],"/pfmcEval/flowApproval"),method:"post",data:t}).then((function(t){if(r.close(),"0"===t.code){var a="submit"===e?"提交成功":"退回成功";i.msgSuccess(a),i.closeWorkflowPage(i.flowParams.ihrHome)}else i.$notify({title:"服务调用异常",message:t.msg,type:"error"})})).catch((function(e){try{r.close()}catch(t){}i.$notify({title:"网络异常",message:res.message,type:"error"})})).finally((function(){try{r.close()}catch(e){}}))}}},d=u,f=(i("af49"),i("2877")),h=Object(f["a"])(d,r,a,!1,null,"3a6979af",null);t["default"]=h.exports},e668:function(e,t,i){}}]);