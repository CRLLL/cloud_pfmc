(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0632e125"],{"4de5":function(e,t,i){"use strict";i.r(t),i.d(t,"getPfmcEvalById",(function(){return s})),i.d(t,"addPfmcEvaluate",(function(){return a}));var r=i("b775"),o=i("b854");function s(e){return Object(r["a"])({url:"".concat(o["pfmcExecution"],"/pfmcEval/getPfmcEvalById/").concat(e),method:"get"})}function a(e){return Object(r["a"])({url:"".concat(o["pfmcExecution"],"/pfmcEval"),method:"post",data:e})}},e70b:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pfmc-import-button-container"},[i("el-button",{attrs:{size:e.size,type:e.type,plain:e.plain,round:e.round,circle:e.circle,disabled:e.disabled,icon:e.icon},on:{click:function(t){e.showDialog=!0}}},[e._v(e._s(e.btnText))]),e._v(" "),i("el-dialog",{ref:"selectEmpDialog",attrs:{visible:e.showDialog,title:e.title,"close-on-click-modal":!1,"append-to-body":"",width:"90%"},on:{"update:visible":function(t){e.showDialog=t},open:e.open,close:e.close}},[i("div",{staticClass:"app-container"},[i("el-form",{staticStyle:{"margin-bottom":"30px"}},[i("el-row",[i("el-col",{attrs:{span:8}},[i("span",{staticStyle:{"font-weight":"bold"}},[e._v("被考核人信息")])])],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"员工编号："}},[i("span",[e._v(e._s(e.evalEmp.empNumber))])])],1),e._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"姓名："}},[i("span",[e._v(e._s(e.evalEmp.empName))])])],1),e._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"部门："}},[i("span",[e._v(e._s(e.evalEmp.orgName))])])],1)],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"考核期间："}},[i("span",[e._v(e._s(e.periodName))])])],1),e._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"考核打分人："}},[i("span",[e._v(e._s(e.evalPersonShow))])])],1),e._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"打分方式："}},[i("span",[e._v(e._s(e.scoreModeName))])])],1)],1)],1),e._v(" "),i("el-form",{attrs:{inline:!0,"label-width":"120px"}},[i("el-collapse",{ref:"previewContain",staticStyle:{width:"100%","border-bottom":"1"},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.itemSectionList,(function(t,r){return i("el-collapse-item",{key:t.formSectionId,staticStyle:{width:"100%"},attrs:{name:r}},[i("template",{slot:"title"},[i("div",{staticStyle:{width:"100%"}},[i("div",{staticStyle:{float:"left","margin-top":"13px",width:"150px","font-weight":"bold"}},[e._v(e._s(t.sectionName))]),e._v(" "),e.isHasGroupHeight(t)?i("div",{staticStyle:{float:"right","margin-left":"10px","margin-top":"15px",width:"250px"}},[i("el-form-item",{attrs:{label:"组间权重"}},[i("el-input",{staticStyle:{margin:"5px 0 0 0",width:"50px","line-height":"20px",height:"20px"},attrs:{disabled:!0},model:{value:t.wt,callback:function(i){e.$set(t,"wt",i)},expression:"apply.wt"}}),e._v(" "),i("span",[e._v("%")])],1)],1):e._e()])]),e._v(" "),i("div",{staticStyle:{width:"100%"}},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,"row-key":e.getRowKeys,"expand-row-keys":e.expands,"tree-props":{children:"children",hasChildren:"hasChildren"},"empty-text":" ","show-summary":!0,"summary-method":e.getGroupSum},on:{"current-change":e.toggleRowExpansion}},[i("el-table-column",{attrs:{label:"序号",type:"index"}}),e._v(" "),e._l(t.itemFieldList,(function(t,r){return e.isShowColumn(t)?i("el-table-column",{key:r,attrs:{prop:t.prop,width:t.width,label:t.fieldName,"show-overflow-tooltip":!0,align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return["select"===t.fieldType&&r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v(e._s(r.row[t.prop].itemValue))]:[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}},e._l(t.selectValue,(function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})})),1)]],2):"date"===t.fieldType&&r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v(e._s(r.row[t.prop].itemValue))]:[i("el-date-picker",{staticStyle:{width:"100%",height:"100%","line-height":"100%"},attrs:{type:"date",placeholder:"选择日期"},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}})]],2):r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v(e._s(r.row[t.prop].itemValue))]:[i("el-input",{staticStyle:{width:"100%",height:"100%","line-height":"100%"},attrs:{type:"textarea"},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}})]],2):e._e()]}}],null,!0)}):e._e()})),e._v(" "),0==e.widthPerIsShow?i("el-table-column",{attrs:{type:"expand",align:"center"},scopedSlots:e._u([{key:"default",fn:function(r){return[i("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[e._l(t.expendFieldList,(function(t,o){return[i("el-row",[e.isShowColumn(t,!1)?i("el-form-item",{attrs:{label:t.fieldName,prop:t.prop}},["select"===t.fieldType&&r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v(e._s(r.row[t.prop].itemValue))]:[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}},e._l(t.selectValue,(function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})})),1)]],2):"date"===t.fieldType&&r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v(e._s(r.row[t.prop].itemValue))]:[i("el-date-picker",{staticStyle:{width:"100%",height:"100%","line-height":"100%"},attrs:{type:"date",placeholder:"选择日期"},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}})]],2):r.row[t.prop]?i("div",{staticClass:"pfmc_content"},[e.isDisableColumn(t)?[e._v(e._s(r.row[t.prop].itemValue))]:[i("el-input",{staticStyle:{width:"100%",height:"100%","line-height":"100%"},attrs:{type:"textarea",disabled:e.isDisableColumn(t)},model:{value:r.row[t.prop].itemValue,callback:function(i){e.$set(r.row[t.prop],"itemValue",i)},expression:"scope.row[item.prop].itemValue"}})]],2):e._e()]):e._e()],1)]}))],2)]}}],null,!0)}):e._e()],2)],1)],2)})),1),e._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.finalScoreRowData,"show-header":!1}},[i("el-table-column",{attrs:{prop:"idx",width:"48"}}),e._v(" "),e.isShowPage?i("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[i("b",[e._v("最终得分：")]),e._v("\n              "+e._s(t.row.score)+"\n            ")]}}],null,!1,752033799)}):e._e(),e._v(" "),i("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("合计总分：")]}}])}),e._v(" "),i("el-table-column",{attrs:{align:"center",width:e.finalScoreRowData[0].selfWidth},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              自评分\n              "),i("br"),e._v("\n              "+e._s(t.row.selfScore)+"\n            ")]}}])}),e._v(" "),e._l(e.evalPersonList,(function(t,r){return e.isShowTotalScore(r)?i("el-table-column",{key:r,attrs:{align:"center",width:e.finalScoreRowData[0]["scoreWidth"+(r+1)]},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              领导"+e._s(r+1)+"评分\n              "),i("br"),e._v("\n              "+e._s(t.row["score"+(r+1)])+"\n            ")]}}],null,!0)}):e._e()}))],2)],1)],1)])],1)},o=[],s=(i("55dd"),i("28a5"),i("7f7f"),i("3b2b"),i("c5f6"),i("ac6a"),i("c1df")),a=i.n(s),l=i("4de5"),n={name:"ViewEvalDetail",components:{},props:{size:{type:String,required:!1},type:{type:String,default:"primary"},plain:{type:Boolean,default:!1},round:{type:Boolean,default:!1},circle:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},icon:{type:String,default:""},btnText:{type:String,default:"详细"},title:{type:String,default:"查看流程页面"},procInstId:{type:String,default:void 0}},data:function(){return{showDialog:!1,eval:{},widthPerIsShow:!0,loading:!0,secGroupMap:{},formSetSectionList:[],itemSectionList:[],lastGroupFieldList:[],viewStage:void 0,evalEmp:{},evalPersonList:[],pfmcProgram:{},scoreModeName:"",loginEmp:{},pfmcEvaluate:{},approverMap:{},expands:[],vars:{},activeNames:[],evalPersonShow:void 0,isCopyScoreFlag:1,isOnlyShowCurLeader:!0,isShowPage:!1,periodName:void 0,flowParams:{TASK_DEF_KEY_:"EmpConfirm",taskType:"1"}}},created:function(){},mounted:function(){},computed:{finalScoreRowData:function(){var e={idx:" "};e.score=this.pfmcEvaluate.score,e.selfScore=this.pfmcEvaluate.selfScore,e.selfWidth=this.scoreColWidthObj.selfWidth;for(var t=0,i=this.evalPersonList?this.evalPersonList.length:0;t<i;t++)e["score"+(t+1)]=this.pfmcEvaluate["score"+(t+1)],e["scoreWidth"+(t+1)]=this.scoreColWidthObj["scoreWidth"+this.evalPersonList[t].empId];var r=[];return r.push(e),r},scoreColWidthObj:function(){var e={};return this.itemSectionList.length<=0?e:(this.itemSectionList[this.itemSectionList.length-1].itemFieldList.forEach((function(t){"4"===t.otherAttr?e.selfWidth=t.width:"5"===t.otherAttr&&(e["scoreWidth"+t.prop]=t.width)})),e)}},methods:{toggleRowExpansion:function(e){this.expands=[],this.expands.push(e.rowId)},getRowKeys:function(e){return e.rowId},isShowTotalScore:function(e){if(this.isShowPage)return!0;var t=this.getCurItem(this.evalPersonList,this.loginEmp.empId,"empId"),i=t?t.inListIndex:-1;return this.isOnlyShowCurLeader?e==i:e<=i},isHasGroupHeight:function(e){return this.pfmcProgram.isHaveGroupWeight&&e&&"score"!=e.sectionType&&e.wt},isDisableColumn:function(e){if(this.isShowPage)return!0;var t=!1;return t="5"==e.otherAttr?this.loginEmp.empId!=e.prop||"2"==this.flowParams.taskType:e.viewStage<this.viewStage||"2"==this.flowParams.taskType,t},isShowColumn:function(e){if(this.isShowPage)return!0;var t=!1;if("5"==e.otherAttr)if(this.isOnlyShowCurLeader)t=this.loginEmp.empId==e.prop;else{var i=this.getCurItem(this.evalPersonList,this.loginEmp.empId,"empId"),r=i?i.inListIndex:-1,o=this.getCurItem(this.evalPersonList,e.prop,"empId"),s=o?o.inListIndex:-1;t=s<=r}else t=e.viewStage<=this.viewStage;return t},$_businessVaildCallBack:function(){for(var e=0;e<this.itemSectionList.length;e++){for(var t=this.itemSectionList[e],i=0;i<t.itemFieldList.length;i++){var r=t.itemFieldList[i];if("Y"===r.isnotnull&&this.isShowColumn(r)&&!this.isDisableColumn(r))for(var o=0;o<t.tableData.length;o++){var s=t.tableData[o];if(s[r.prop]&&!s[r.prop].itemValue)return this.$notify({title:r.fieldName+"不能为空",message:"",type:"error"}),!1}}for(var a=0;t.expendFieldList&&a<t.expendFieldList.length;a++){var l=t.expendFieldList[a];if("Y"===l.isnotnull&&this.isShowColumn(l)&&!this.isDisableColumn(l))for(var n=0;n<t.tableData.length;n++){var c=t.tableData[n];if(c[l.prop]&&!c[l.prop].itemValue)return this.$notify({title:l.fieldName+"不能为空",message:"",type:"error"}),!1}}}return!0},buildPfmcEvaluate:function(){for(var e={procInstId:this.procInstId,groupLists:[],selfScore:0,score1:0,score2:0,score3:0,score4:0,score:0,level:void 0},t=0;t<this.itemSectionList.length;t++){for(var i=this.itemSectionList[t],r={itemGroupId:i.groupId,itemRowList:[],selfScore:0,score1:0,score2:0,score3:0,score4:0},o=0;o<i.tableData.length;o++){var s=i.tableData[o],a={rowId:s.rowId,itemList:[]};for(var l in s){if("4"===s[l].otherAttr){var n=parseFloat(s[l].itemValue||0,this.pfmcProgram.decimalPlace||2);if(!isNaN(n))if("weight"===this.pfmcProgram.scoreMode)r.selfScore+=n;else{var c=this.getItemFromObj(s,"3","otherAttr");if(c){var m=parseInt(c.itemValue);r.selfScore+=n*m/100}else r.selfScore+=n}}else if("5"===s[l].otherAttr){var p=parseFloat(s[l].itemValue||0,this.pfmcProgram.decimalPlace||2),d=this.getCurItem(this.evalPersonList,l,"empId");if(!isNaN(p))if("weight"===this.pfmcProgram.scoreMode)r["score"+(d.inListIndex+1)]+=p;else{var h=this.getItemFromObj(s,"3","otherAttr");if(h){var u=parseInt(h.itemValue);r["score"+(d.inListIndex+1)]+=p*u/100}else r["score"+(d.inListIndex+1)]+=p}}if("rowId"!=l){var f={itemId:s[l].itemId,itemValue:s[l].itemValue};a.itemList.push(f)}}r.itemRowList.push(a)}e.groupLists.push(r),this.isHasGroupHeight(i)?(e.selfScore+=r.selfScore*i.wt/100,e.score1+=r.score1*i.wt/100,e.score2+=r.score2*i.wt/100,e.score3+=r.score3*i.wt/100,e.score4+=r.score4*i.wt/100):(e.selfScore+=r.selfScore,e.score1+=r.score1,e.score2+=r.score2,e.score3+=r.score3,e.score4+=r.score4)}for(var v=0;v<this.evalPersonList.length;v++){var w=this.evalPersonList[v],g=w.weight;e.score+=e["score"+(v+1)]*g/100}return this.pfmcProgram.decimalPlace=parseInt(this.pfmcProgram.decimalPlace)||2,e.selfScore=this.switchDecimalPlace(e.selfScore,this.pfmcProgram.decimalPlace),e.score1=this.switchDecimalPlace(e.score1,this.pfmcProgram.decimalPlace),e.score2=this.switchDecimalPlace(e.score2,this.pfmcProgram.decimalPlace),e.score3=this.switchDecimalPlace(e.score3,this.pfmcProgram.decimalPlace),e.score4=this.switchDecimalPlace(e.score4,this.pfmcProgram.decimalPlace),e.score=this.switchDecimalPlace(e.score,this.pfmcProgram.decimalPlace),e},switchDecimalPlace:function(e,t){for(var i=1,r=0;r<t;r++)i*=10;return e=Math.round(e*i)/i,e},getGroupSum:function(e){var t=this,i=e.columns,r=e.data,o=[];return i.forEach((function(e,i){if(o[i]="0",0!==i){var s=r.map((function(t){return t[e.property]})),a=0;s.every((function(e){return e&&("4"===e.otherAttr||"5"===e.otherAttr)}))?(o[i]=r.reduce((function(i,r){a++;var o=0,l=t.getItemFromObj(r,"3","otherAttr"),n=l?parseInt(l.itemValue):null;if(t.verifyScore(r[e.property].itemValue,n,t.pfmcProgram.scoreMode,r[e.property].sectionType,r[e.property].decimalPlace)?o="weight"===t.pfmcProgram.scoreMode?Number(r[e.property].itemValue):n?Number(r[e.property].itemValue)*n/100:Number(r[e.property].itemValue):(r[e.property].itemValue="",o=0),a==s.length){var c=t.getCurItem(t.itemSectionList,r[e.property].formSectionId,"formSectionId"),m=t.isHasGroupHeight(c)?Number(c.wt):100;return isNaN(o)?t.switchDecimalPlace(Number(i)*m/100,t.pfmcProgram.decimalPlace):t.switchDecimalPlace((Number(i)+o)*m/100,t.pfmcProgram.decimalPlace)}return isNaN(o)?t.switchDecimalPlace(Number(i),t.pfmcProgram.decimalPlace):t.switchDecimalPlace(Number(i)+o,t.pfmcProgram.decimalPlace)}),0),o[i]+=""):s.every((function(e){return e&&"3"===e.otherAttr}))?(o[i]=s.reduce((function(e,t){var i=Number(t.itemValue);return isNaN(i)?e:e+i}),0),o[i]):o[i]=" "}else o[i]="合计"})),this.pfmcEvaluate=this.buildPfmcEvaluate(),o},verifyScore:function(e,t,i,r,o){o||(o="");var s=new RegExp("^([0-9])+(.)?(\\d{1,"+o+"})?$"),a=new RegExp("^(0){1}(.){1}(\\d{1,"+o+"})?$"),l=new RegExp("^((-)?([0-9])*(.)?(\\d{1,"+o+"})?)$"),n=new RegExp("^((-)?0{1}(.){1}(\\d{1,"+o+"})?)$");if("score"===r){if(!l.test(e)&&!n.test(e)&&e)return this.$notify({title:"请输入数字，且注意保留的小数位数",message:"",type:"error"}),!1}else if(!s.test(e)&&!a.test(e)&&e)return this.$notify({title:"请输入正数，且注意保留的小数位数",message:"",type:"error"}),!1;if("weight"===i&&"score"!=r){if(!t)return this.$notify({title:"无法获取权重",message:"",type:"error"}),!1;if(e>t)return this.$notify({title:"不能大于权重",message:"",type:"error"}),!1}else if("five"===i){if(e>5)return this.$notify({title:"当前打分方式为五分制",message:"",type:"error"}),!1}else if("ten"===i){if(e>10)return this.$notify({title:"当前打分方式为十分制",message:"",type:"error"}),!1}else if("hundred"===i&&e>100)return this.$notify({title:"当前打分方式为百分制",message:"",type:"error"}),!1;return!0},sortNumber:function(e,t){return parseInt(e.showOrder)-parseInt(t.showOrder)},getItemFromObj:function(e,t,i){var r=null;for(var o in e){var s=e[o];if(s&&s[i]===t){r=s;break}}return r},getCurItem:function(e,t,i){for(var r=null,o=0;e&&o<e.length;o++){var s=e[o];if(s[i]===t){r=s,r.inListIndex=o;break}}return r},buildHorizontalTitle:function(e,t){for(var i=[],r={titleFields:i},o=0,s=0;s<e.formSetFieldList.length;s++){var a=e.formSetFieldList[s],l={fieldName:a.fieldName,showOrder:a.showOrder,prop:"5"===a.otherAttr?a.empId:a.formFieldId,fieldType:a.fieldType,viewStage:parseInt(a.viewStage),selectValue:"select"===a.fieldType?a.selectValue.split(","):[],width:"1"==e.widthPerType?t*parseInt(a.widthper)/100:a.widthper,otherAttr:a.otherAttr,isnotnull:a.isnotnull,ishasfile:a.ishasfile};this.isShowColumn(l)&&(o+=l.width),i.push(l)}return i.sort(this.sortNumber),this.setColumnWidth(o,t,i),r},setColumnWidth:function(e,t,i){for(var r=.95*t/e,o=0;o<i.length;o++){var s=i[o];this.isShowColumn(s)&&(s.width=s.width*r+"px")}},buildVerticalTitle:function(e,t){for(var i=[],r=[],o={titleFields:i,expendFields:r},s=["2","3","4","5"],a=0;a<e.formSetFieldList.length;a++){var l=e.formSetFieldList[a],n={fieldName:l.fieldName,showOrder:l.showOrder,prop:"5"===l.otherAttr?l.empId:l.formFieldId,fieldType:l.fieldType,viewStage:parseInt(l.viewStage),selectValue:"select"===l.fieldType?l.selectValue.split(","):[],width:"1"==e.widthPerType?t*parseInt(l.widthper)/100:l.widthper+"px",otherAttr:l.otherAttr,isnotnull:l.isnotnull,ishasfile:l.ishasfile};s.indexOf(l.otherAttr)>=0?(i.push(n),this.isShowColumn(n)&&n.width):r.push(n)}return i.sort(this.sortNumber),r.sort(this.sortNumber),this.setColumnWidth(titleNum,t,i),o},buildTablelData:function(e,t){for(var i=[],r=0;e&&r<e.length;r++){var o=e[r],s=o?o.itemList:null,l={};l.rowId=o.rowId;for(var n=!1,c=0;c<t.formSetFieldList.length;c++){n=!1;var m=t.formSetFieldList[c];if("5"===m.otherAttr){var p=this.getCurItem(s,m.empId,"leaderEmpId");if(p){var d=p.itemId;l[m.empId]={},l[m.empId]["itemId"]=d,l[m.empId]["itemValue"]="date"===m.fieldType?a()(p.itemValue).format("YYYY-MM-DD"):p.itemValue,l[m.empId]["sectionType"]=t.sectionType,l[m.empId]["ishasfile"]=m.ishasfile,l[m.empId]["otherAttr"]=m.otherAttr,l[m.empId]["decimalPlace"]=m.decimalPlace,l[m.empId]["formSectionId"]=t.formSectionId,this.copyScore(this.loginEmp.empId,m.empId,l,this.evalPersonList,this.isCopyScoreFlag),n=!0}}else{var h=this.getCurItem(s,m.formFieldId,"formFieldId");if(h){var u=h.itemId;l[m.formFieldId]={},l[m.formFieldId]["itemId"]=u,l[m.formFieldId]["itemValue"]="date"===m.fieldType?a()(h.itemValue).format("YYYY-MM-DD"):h.itemValue,l[m.formFieldId]["otherAttr"]=m.otherAttr,l[m.formFieldId]["sectionType"]=t.sectionType,l[m.formFieldId]["ishasfile"]=m.ishasfile,l[m.formFieldId]["decimalPlace"]=m.decimalPlace,l[m.formFieldId]["formSectionId"]=t.formSectionId,n=!0}}}n&&i.push(l)}return i},copyScore:function(e,t,i,r,o){if(!this.isShowPage&&e===t)if("1"==o){var s=this.getItemFromObj(i,"4","otherAttr");i[t]["itemValue"]=s?s.itemValue:""}else if("2"==o){var a=this.getCurItem(r,e,"empId"),l=a?a.inListIndex:-1;if(l>0){var n=r[l-1],c=itemList[n.empId];i[t]["itemValue"]=c?c.itemValue:""}else{var m=this.getItemFromObj(i,"4","otherAttr");i[t]["itemValue"]=m?m.itemValue:""}}},buildItemList:function(e,t,i,r){var o=[];if(e&&0!=e.length){for(var s=0;s<e.length;s++){var a=e[s],l=t[a.formSectionId],n=l.itemRowList,c={sectionName:a.sectionName,sectionType:a.sectionType,formSectionId:a.formSectionId,showOrder:a.showOrder,itemFieldList:[],expendFieldList:[],tableData:[],groupId:l.itemGroupId,wt:l.wt};if(!a.formSetFieldList||0==a.formSetFieldList.length)break;var m=null;m=r?this.buildHorizontalTitle(a,i):this.buildVerticalTitle(a,i),c.itemFieldList=m.titleFields,c.expendFieldList=m.expendFields,c.tableData=this.buildTablelData(n,a),o.push(c),o.sort(this.sortNumber),this.activeNames.push(s)}return o}},showPfmcTable:function(){var e=this;this.flowParams.TASK_DEF_KEY_.indexOf("EmpFillEval")>=0?this.viewStage=2:this.flowParams.TASK_DEF_KEY_.indexOf("ManAuditEval")>=0?this.viewStage=3:this.flowParams.TASK_DEF_KEY_.indexOf("EmpConfirm")>=0&&(this.viewStage=4,this.isShowPage=!0),Object(l["getPfmcEvalById"])(this.procInstId).then((function(t){e.eval=t.data,e.evalEmp=e.eval.pfmcEmployee,e.evalPersonList=e.eval.evalPersonList,e.widthPerIsShow="1"===e.eval.showType,e.periodName=e.eval.cycleName,e.loginEmp=e.eval.loginEmployee,e.pfmcProgram=e.eval.pfmcProgram,e.formSetSectionList=e.eval.fmSetSectionList;var i=e.$refs.previewContain.$el.offsetWidth;e.secGroupMap=e.eval.secGroupMap,e.itemSectionList=e.buildItemList(e.formSetSectionList,e.secGroupMap,i,e.widthPerIsShow)||[],e.lastGroupFieldList=e.itemSectionList[e.itemSectionList.length-1].itemFieldList,e.setLinkApproveMan(),e.setEvalPerson(),e.setScoreModeName(e.pfmcProgram.scoreMode)}))},setScoreModeName:function(e){"five"===e?this.scoreModeName="五分制":"ten"===e?this.scoreModeName="十分制":"hundred"===e?this.scoreModeName="百分制":"weight"===e?this.scoreModeName="权重分制":this.$notify({title:"打分方式未设置，请联系管理员",message:"",type:"error"})},setEvalPerson:function(){for(var e=0;e<this.evalPersonList.length;e++){var t=this.evalPersonList[e];0==e?this.evalPersonShow=t.empName:this.evalPersonShow+=","+t.empName}},setLinkApproveMan:function(){var e={},t=null;"EmpConfirm"!==this.flowParams.TASK_DEF_KEY_&&("EmpFillEval"===this.flowParams.TASK_DEF_KEY_?(t=this.evalPersonList[0],this.approverMap["ManAuditEval1"]=e):"ManAuditEval1"===this.flowParams.TASK_DEF_KEY_?(t=this.evalPersonList[1],this.approverMap["ManAuditEval2"]=e):"ManAuditEval2"===this.flowParams.TASK_DEF_KEY_?(t=this.evalPersonList[2],this.approverMap["ManAuditEval3"]=e):"ManAuditEval3"===this.flowParams.TASK_DEF_KEY_&&(t=this.evalPersonList[3],this.approverMap["ManAuditEval4"]=e),t?(e.userName=t.empNumber,e.nickName=t.empName,this.vars["isEnd"]="0"):(this.vars["isEnd"]="1",e.userName=this.evalEmp.empNumber,e.nickName=this.evalEmp.empName,this.approverMap["EmpConfirm"]=e))},open:function(){this.showPfmcTable()},close:function(){},handleFinish:function(){this.$emit("select-finish",this.resultList),this.reset(),this.showSelectEmpDialog=!1},handleCancel:function(){this.reset(),this.showSelectEmpDialog=!1},reset:function(){this.queryForm={pageNum:1,pageSize:10,deptIds:[],empNumber:void 0},this.resultList=[]}},watch:{}},c=n,m=i("2877"),p=Object(m["a"])(c,r,o,!1,null,"7334f1d2",null);t["default"]=p.exports}}]);