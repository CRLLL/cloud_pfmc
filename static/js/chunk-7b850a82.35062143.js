(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b850a82"],{"019b":function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var r=o("b775"),s=o("365c");function i(e,t){return Object(r["a"])({url:"".concat(s["a"],"/rutask/getNextNode?task_id=").concat(e),method:"post",data:t||{}})}},ccb6:function(e,t,o){"use strict";o.r(t);var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.title,visible:e.open,width:"600px"},on:{"update:visible":function(t){e.open=t}}},[o("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[e.isLoadNextNode?o("el-form-item",{attrs:{label:"下一处理节点"}},[o("div",[e._v(e._s(e.nextNodeName))])]):e._e(),e._v(" "),e.isShowApprover?o("el-form-item",{attrs:{label:"审批人",prop:"ASSIGNEE_NAME",rules:{required:!0,message:"审批人不能为空",trigger:"change"}}},[o("el-input",{staticStyle:{width:"78%",display:"inline-block"},attrs:{placeholder:"请输入审批人",clearable:!1,readonly:""},model:{value:e.form.ASSIGNEE_NAME,callback:function(t){e.$set(e.form,"ASSIGNEE_NAME",t)},expression:"form.ASSIGNEE_NAME"}}),e._v(" "),e.isShowApproverChooser?o("el-button",{attrs:{round:""},on:{click:e.addPerson}},[e._v("选择")]):e._e()],1):e._e(),e._v(" "),e.needOpnion?o("el-form-item",{attrs:{label:"审批意见",prop:"option"}},[o("el-input",{attrs:{type:"textarea",placeholder:"请输入审批意见"},model:{value:e.form.option,callback:function(t){e.$set(e.form,"option",t)},expression:"form.option"}})],1):e._e()],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{plain:"",icon:"el-icon-close"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),o("el-button",{attrs:{type:"primary",icon:"el-icon-check"},on:{click:e.ok}},[e._v("确定")])],1),e._v(" "),o("select-approver",{ref:"selectApprover",on:{"handle-approver":e.handleApprover}})],1)},s=[],i=(o("7f7f"),o("ac6a"),o("5df3"),o("f400"),o("019b")),a={name:"ihr-wf-submt",components:{SelectApprover:function(){return o.e("chunk-1a0fb937").then(o.bind(null,"4320"))}},props:{flowParams:{type:Object,default:function(){return{}}},vars:[Object,Map],approverMap:[Object,Map],submitType:String},data:function(){var e=this.flowParams.FIRST_ACT_DEF_KEY===this.flowParams.TASK_DEF_KEY_,t=!e;return{open:!1,isFirstNode:e,needOpnion:t,title:"提交审批",approver:"",form:{ASSIGNEE_:"",ASSIGNEE_NAME:"",option:e?"提交审批":""},nextNodeCode:"",nextNodeName:"",rules:{option:[{required:t,message:"审批意见不能为空",trigger:"blur"},{max:100,message:"审批意见不能超过100个字",trugger:"blur"}]}}},computed:{isLoadNextNode:function(){return this.flowParams&&this.flowParams.PROC_INST_ID_&&"submit"===this.submitType},isShowApprover:function(){return"submit"===this.submitType&&"end"!==this.nextNodeCode},isShowApproverChooser:function(){return!(this.approverMap&&this.approverMap[this.nextNodeCode]&&this.approverMap[this.nextNodeCode].userName)}},watch:{open:function(e,t){e&&this.init()}},methods:{init:function(){var e=this;this.isFirstNode||(this.form.option="submit"===this.submitType?"同意":"不同意"),this.isLoadNextNode&&Object(i["a"])(this.flowParams.ID_,this.vars).then((function(t){"0"===t.code&&t.data?(e.nextNodeCode=t.data.code,e.nextNodeName=t.data.name,e.approverMap&&e.approverMap[e.nextNodeCode]&&e.approverMap[e.nextNodeCode].userName?(e.form.ASSIGNEE_=e.approverMap[e.nextNodeCode].userName,e.form.ASSIGNEE_NAME=e.approverMap[e.nextNodeCode].nickName||e.form.ASSIGNEE_):(e.form.ASSIGNEE_="",e.form.ASSIGNEE_NAME="")):e.$notify({title:"服务调用异常",message:t.msg,type:"error"})})).catch((function(t){e.$notify({title:"网络异常",message:res.message,type:"error"})}))},addPerson:function(){"submit"!==this.submitType||this.nextNodeCode?this.$refs["selectApprover"].open=!0:this.msgError("下一办理环节加载失败，无法提交!")},handleApprover:function(e){this.form.ASSIGNEE_=e.userName,this.form.ASSIGNEE_NAME=e.nickName},ok:function(){var e=this;"submit"!==this.submitType||this.nextNodeCode?this.$refs["form"].validate((function(t){if(t){var o="";switch(e.submitType){case"submit":o="您确定要提交吗？";break;case"turnbackToFirst":o="您确定要退回给发起人吗？";break;case"turnbackToPrevious":o="您确定要退回给上一办理人吗？";break}e.$confirm(o,"提示",{type:"warning"}).then((function(){"submit"===e.submitType?e.submitWf():e.turnbackWf()}))}})):this.msgError("下一办理环节加载失败，无法提交!")},submitWf:function(){var e={PROC_INST_ID_:this.flowParams.PROC_INST_ID_,ID_:this.flowParams.ID_,TASK_DEF_KEY_:this.flowParams.TASK_DEF_KEY_,EXECUTION_ID_:this.flowParams.EXECUTION_ID_,msg:"yes",ASSIGNEE_:this.form.ASSIGNEE_,OPINION:this.form.option,businessId:this.flowParams.BUSINESS_ID,processKey:this.flowParams.BUSINESS_KEY,VAR_MAP_:this.vars,nextNodeCode:this.nextNodeCode,nextNodeName:this.nextNodeName};this.$emit("submit-wf",e),this.cancel()},turnbackWf:function(){var e={PROC_INST_ID_:this.flowParams.PROC_INST_ID_,ID_:this.flowParams.ID_,TASK_DEF_KEY_:this.flowParams.TASK_DEF_KEY_,EXECUTION_ID_:this.flowParams.EXECUTION_ID_,msg:"no",turnbackType:this.submitType,FIRST_ACT_DEF_KEY:this.flowParams.FIRST_ACT_DEF_KEY,OPINION:this.form.option,businessId:this.flowParams.BUSINESS_ID,processKey:this.flowParams.BUSINESS_KEY,VAR_MAP_:this.vars};this.$emit("turnback-wf",e),this.cancel()},reset:function(){this.resetForm("form")},cancel:function(){this.open=!1}}},n=a,p=o("2877"),c=Object(p["a"])(n,r,s,!1,null,null,null);t["default"]=c.exports}}]);