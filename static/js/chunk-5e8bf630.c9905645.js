(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e8bf630","chunk-2d21062b","chunk-6b45e15b","chunk-2d21062b"],{3978:function(e,t,r){"use strict";r.r(t),r.d(t,"getFlowInofByPid",(function(){return s})),r.d(t,"flowApproval",(function(){return o})),r.d(t,"saveDraft",(function(){return n}));var i=r("b775"),a=r("b854");function s(e){return Object(i["a"])({url:"".concat(a["pfmcExecution"],"/empGrade/getFlowInofByPid/").concat(e),method:"get"})}function o(e){return Object(i["a"])({url:"".concat(a["pfmcExecution"],"/empGrade/flowApproval"),method:"post",data:e})}function n(e){return Object(i["a"])({url:"".concat(a["pfmcExecution"],"/empGrade/saveDraft"),method:"post",data:e})}},"42d5":function(e,t,r){"use strict";var i=r("e1f5"),a=r.n(i);a.a},52941:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("7514"),core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es6_array_find__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_1__),_views_pfmc_api_pfmcEvalManage_empGrade_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("3978");__webpack_exports__["a"]={components:{ExportData:function(){return __webpack_require__.e("chunk-336f6cc4").then(__webpack_require__.bind(null,"2ee5"))},WorkflowPage:function(){return __webpack_require__.e("chunk-654254cb").then(__webpack_require__.bind(null,"76d1"))},ViewEvalDetail:function(){return Promise.all([__webpack_require__.e("chunk-0632e125"),__webpack_require__.e("chunk-b5d27614")]).then(__webpack_require__.bind(null,"e70b"))}},props:{flowParams:Object},data:function(){return{procInstId:void 0,periodName:void 0,groupName:void 0,approverMap:{},vars:{},gradeAssessor:{},empGradeList:[],levelScoreList:[],maxScorer:0,distributionInfo:void 0,isForceDistribution:!1,distributionList:[{title:"可用个数"},{title:"已使用个数"}],showSaveDraftBtn:"leaderAssessGrade"===this.flowParams.TASK_DEF_KEY_,excelFileName:"绩效考核等级"}},created:function(){this.openFlowPage()},mounted:function(){},computed:{},methods:{$_businessVaildCallBack:function(){if(!this.empGradeList.every((function(e){return null!==e.grade})))return this.msgError("等级不能为空"),!1;if(this.isForceDistribution)for(var e=0;e<this.levelScoreList.length;e++){var t=this.levelScoreList[e].level;if("no-limit"!==this.distributionList[0][t]&&this.distributionList[1][t]>this.distributionList[0][t])return this.msgError("等级"+t+"超过可用人数"),!1}return!0},cellClass:function(e){e.row;var t=e.column,r=e.rowIndex;e.columnIndex;if(1===r&&"no-limit"!==this.distributionList[0][t.label]&&this.distributionList[r][t.label]>this.distributionList[0][t.label])return"cell-warning"},getSumScoreCalcDetail:function(e){var t=e.relationEvalEmpList;if(t&&t.length>0){var r=e.sumScore+" = ";return t.forEach((function(t,i){r=r+(0===i?"":" + ")+e["score"+(i+1)]+"*"+t.weight+"%"})),r}return e.sumScore+"="+e.score1+"*100%"},distributionFormat:function(e,t,r){return"no-limit"===r?"不限":r},gradeChange:function(){var e=this;this.isForceDistribution&&(this.levelScoreList.forEach((function(t){e.distributionList[1][t.level]=0})),this.empGradeList.forEach((function(t){if(t.grade){var r=e.distributionList[1][t.grade],i=e.distributionList[1];i[t.grade]=r+1,e.$set(e.distributionList,1,i)}})))},setDistributionEmpGrade:function setDistributionEmpGrade(){var _this2=this;this.empGradeList.forEach((function(e,ei){e.grade||null===e.sumScore||_this2.levelScoreList.forEach((function(s,si){s.levelHighLimit&&s.highLimitLabel&&s.levelLowLimit&&s.lowLimitLabel&&eval(e.sumScore+s.highLimitLabel+s.levelHighLimit)&&eval(e.sumScore+s.lowLimitLabel+s.levelLowLimit)&&_this2.setEmpGrade(ei,si)}))}))},setEmpGrade:function(e,t){if(!(t>this.levelScoreList.length-1)){var r=this.levelScoreList[t].level;"no-limit"===this.distributionList[0][r]?(this.empGradeList[e].grade=r,this.distributionList[1][r]+=1):this.distributionList[0][r]>this.distributionList[1][r]?(this.empGradeList[e].grade=r,this.distributionList[1][r]+=1):this.distributionList[0][r]<=this.distributionList[1][r]&&this.setEmpGrade(e,++t)}},openFlowPage:function(){var e=this,t=this.fullScreenLoading("正在加载流程页面，请稍后……");this.procInstId=this.flowParams.PROC_INST_ID_,Object(_views_pfmc_api_pfmcEvalManage_empGrade_js__WEBPACK_IMPORTED_MODULE_2__["getFlowInofByPid"])(this.procInstId).then((function(r){t.close(),"0"===r.code?(e.periodName=r.data.gradeAssessor.cycle_name,e.groupName=r.data.gradeAssessor.group_name,e.gradeAssessor=r.data.gradeAssessor,e.empGradeList=r.data.empGradeList,e.approverMap=r.data.approverMap,e.levelScoreList=r.data.levelScoreList,e.distributionInfo=r.data.distribution,e.maxScorer=r.data.maxScorer,e.excelFileName=e.periodName+"-"+e.groupName+e.excelFileName,e.vars["isEnd"]=r.data.gradeAssessor.is_hr_review_grade?"false":"true",null!==e.distributionInfo&&(e.isForceDistribution=!0,e.levelScoreList.forEach((function(t){var r=e.distributionInfo.detail.find((function(e){return e.scoreId===t.scoreId}));e.distributionList[0][t.level]="no-limit"===r.cntCondition?"no-limit":r.empCnt})),e.gradeChange(),e.setDistributionEmpGrade())):e.msgError(r.msg)})).catch((function(r){t.close(),e.msgError(r)}))},drivenFlow:function(e,t){var r=this,i={empGradeList:this.empGradeList,gradeAssessor:this.gradeAssessor};t["empGradeFlowForm"]=i;var a=this.fullScreenLoading("正在驱动流程，请稍后……");Object(_views_pfmc_api_pfmcEvalManage_empGrade_js__WEBPACK_IMPORTED_MODULE_2__["flowApproval"])(t).then((function(t){if(a.close(),"0"===t.code){var i="submit"===e?"提交成功":"退回成功";r.msgSuccess(i),r.closeWorkflowPage(r.flowParams.ihrHome)}else r.$notify({title:"服务调用异常",message:t.msg,type:"error"})})).catch((function(e){try{a.close()}catch(t){}r.$notify({title:"网络异常",message:res.message,type:"error"})})).finally((function(){try{a.close()}catch(e){}}))},saveDraftFlow:function(){var e=this,t={empGradeList:this.empGradeList},r={empGradeFlowForm:t},i=this.fullScreenLoading("正在暂存流程，请稍后……");Object(_views_pfmc_api_pfmcEvalManage_empGrade_js__WEBPACK_IMPORTED_MODULE_2__["saveDraft"])(r).then((function(t){i.close(),"0"===t.code?e.msgSuccess("流程暂存成功"):e.msgError(t.msg)})).catch((function(t){i.close(),e.msgError(t)}))}},watch:{}}},7514:function(e,t,r){"use strict";var i=r("5ca1"),a=r("0a49")(5),s="find",o=!0;s in[]&&Array(1)[s]((function(){o=!1})),i(i.P+i.F*o,"Array",{find:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),r("9c6c")(s)},9675:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("workflow-page",{ref:"wfpage",attrs:{"flow-params":e.flowParams,"approver-map":e.approverMap,vars:e.vars,"show-save-draft-btn":e.showSaveDraftBtn},on:{"driven-flow":e.drivenFlow,"save-draft":e.saveDraftFlow}},[r("div",{staticClass:"app-container"},[r("div",{staticClass:"flow-subject"},[r("b",[e._v("考核周期："+e._s(e.periodName))]),e._v(" "),r("div",{staticClass:"pfmc-btn-bar"},[r("export-data",{attrs:{"task-id":"emp_grade_flow_export",params:{procInstId:e.flowParams.PROC_INST_ID_,fileName:e.excelFileName},btnText:"导出"}})],1)]),e._v(" "),e.isForceDistribution?r("el-table",{attrs:{data:e.distributionList,"cell-class-name":e.cellClass}},[r("el-table-column",{attrs:{label:"正态分布定义",prop:"title"}}),e._v(" "),e._l(e.levelScoreList,(function(t){return r("el-table-column",{key:t.scoreId,attrs:{label:t.level,prop:t.level,formatter:e.distributionFormat,align:"center"}})}))],2):e._e(),e._v(" "),r("br"),e._v(" "),r("el-table",{attrs:{data:e.empGradeList,"row-key":"empId"}},[r("el-table-column",{attrs:{label:"序号",type:"index"}}),e._v(" "),r("el-table-column",{attrs:{label:"员工编号",prop:"empNumber","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("view-eval-detail",{attrs:{type:"text",btnText:e.row.empNumber,procInstId:e.row.evalProcInstId}})]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"姓名",prop:"empName","min-width":"100"}}),e._v(" "),r("el-table-column",{attrs:{label:"组织",prop:"orgName","min-width":"100","show-overflow-tooltip":""}}),e._v(" "),r("el-table-column",{attrs:{label:"职位",prop:"position"}}),e._v(" "),e.maxScorer>=1?r("el-table-column",{attrs:{label:"员工自评",prop:"selfScore"}}):e._e(),e._v(" "),e.maxScorer>=1?r("el-table-column",{attrs:{label:"评分人1",prop:"scoreEmpName1"}}):e._e(),e._v(" "),e.maxScorer>=1?r("el-table-column",{attrs:{label:"评分",prop:"score1"}}):e._e(),e._v(" "),e.maxScorer>=2?r("el-table-column",{attrs:{label:"评分人2",prop:"scoreEmpName2"}}):e._e(),e._v(" "),e.maxScorer>=2?r("el-table-column",{attrs:{label:"评分",prop:"score2"}}):e._e(),e._v(" "),e.maxScorer>=3?r("el-table-column",{attrs:{label:"评分人3",prop:"scoreEmpName3"}}):e._e(),e._v(" "),e.maxScorer>=3?r("el-table-column",{attrs:{label:"评分",prop:"score3"}}):e._e(),e._v(" "),e.maxScorer>=4?r("el-table-column",{attrs:{label:"评分人4",prop:"scoreEmpName4"}}):e._e(),e._v(" "),e.maxScorer>=4?r("el-table-column",{attrs:{label:"评分",prop:"score4"}}):e._e(),e._v(" "),r("el-table-column",{attrs:{label:"最终分",prop:"sumScore",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-tooltip",{attrs:{effect:"light",placement:"top"}},[r("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.getSumScoreCalcDetail(t.row)))]),e._v(" "),r("div",[e._v(e._s(t.row.sumScore))])])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"等级","min-width":"120px",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return["leaderAssessGrade"===e.flowParams.TASK_DEF_KEY_?[r("el-select",{attrs:{placeholder:"请选择..."},on:{change:e.gradeChange},model:{value:t.row.grade,callback:function(r){e.$set(t.row,"grade",r)},expression:"scope.row.grade"}},e._l(e.levelScoreList,(function(e){return r("el-option",{key:e.scoreId,attrs:{label:e.level,value:e.level}})})),1)]:[r("span",[e._v(e._s(t.row.grade))])]]}}])})],1)],1)])},a=[],s=r("52941"),o=s["a"],n=(r("42d5"),r("2877")),l=Object(n["a"])(o,i,a,!1,null,"dfc96296",null);t["default"]=l.exports},b854:function(e,t,r){"use strict";r.r(t),r.d(t,"pfmcSettings",(function(){return i})),r.d(t,"pfmcAsist",(function(){return a})),r.d(t,"pfmcExecution",(function(){return s})),r.d(t,"pfmcEval",(function(){return o}));var i="pfmc-settings",a="pfmc-asist",s="pfmc-execution",o="pfmc-eval"},e1f5:function(e,t,r){}}]);