(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-85cbf3cc","chunk-2d21062b","chunk-a7f119d2","chunk-2d21062b","chunk-2d22d460"],{"09ca":function(e,t,i){"use strict";i.r(t),i.d(t,"getFileList",(function(){return o})),i.d(t,"deleteFile",(function(){return a})),i.d(t,"downloadFile",(function(){return r})),i.d(t,"downloadZip",(function(){return d})),i.d(t,"downloadZipWithFolder",(function(){return l}));var n=i("b775"),s=i("b854");function o(e,t,i){return Object(n["a"])({url:"".concat(s["pfmcAsist"],"/doc/list"),method:"get",params:{businessType:e,businessCode:t,businessId:i}})}function a(e){return Object(n["a"])({url:"".concat(s["pfmcAsist"],"/doc/del"),method:"delete",params:{id:e}})}function r(e){return Object(n["a"])({url:"".concat(s["pfmcAsist"],"/doc/down"),method:"get",params:{id:e},responseType:"blob"})}function d(e,t,i,o){return Object(n["a"])({url:"".concat(s["pfmcAsist"],"/doc/downzip"),method:"get",params:{businessType:e,businessCode:t,businessId:i,zipFileName:o},responseType:"blob"})}function l(e,t){return Object(n["a"])({url:"".concat(s["pfmcAsist"],"/doc/downzipwithfolder/").concat(encodeURIComponent(t)),method:"post",data:e,responseType:"blob"})}},"705e":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-upload",{directives:[{name:"loading",rawName:"v-loading",value:e.fileLoading,expression:"fileLoading"}],ref:"upld",attrs:{action:e.action,headers:e.headers,multiple:!1,data:e.upldData,name:"file",accept:e.accept,"show-file-list":e.showFileList,"list-type":"text","file-list":e.fileList,"before-upload":e.beforeUpload,"on-success":e.handleSuccess,"on-error":e.handleError,"before-remove":e.beforeRemove,"on-remove":e.handleRemove,"on-preview":e.handlePreview,"on-exceed":e.handleExceed,disabled:e.disabled,limit:e.limit,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[e.disabled||e.limitAttained?e._e():i("el-button",{attrs:{size:e.btnSize,plain:e.btnPlain,circle:e.btnCircle,round:e.btnRound,icon:e.btnIcon}},[e._v("\n    "+e._s(e.showBtnText?e.btnText:"")+"\n  ")]),e._v(" "),!e.disabled&&e.showTip?i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[i("span",[e._v("只能上传")]),e._v(" "),i("el-tooltip",{attrs:{effect:"dark",content:e.tipStr,placement:"bottom",enterable:!1}},[i("span",{staticClass:"text-link"},[e._v("图片、文档、pdf、压缩包等格式")])]),e._v(" "),i("span",[e._v("的文件，且不超过 "+e._s(e.maxSize/1024/1024)+"MB.")])],1):e._e()],1)},s=[],o=(i("20d6"),i("7f7f"),i("a481"),i("6762"),i("2fdb"),i("e804"),i("c5f6"),i("5f87")),a=i("09ca"),r=i("b854"),d=i("f792"),l=["jpg","jpeg","png","gif","bmp","doc","docx","xls","xlsx","ppt","pptx","rtf","odt","ods","odp","pdf","txt","zip","rar","7z","gz","xz"],u={name:"ihr-file-upload",props:{businessType:{type:String,required:!0},businessCode:String,businessId:String,businessFormat:Array,disabled:{type:Boolean,default:!1},limit:Number,showFileList:{type:Boolean,default:!0},defaultList:Array,btnSize:{type:String,default:"small"},btnPlain:{type:Boolean,default:!0},btnCircle:{type:Boolean,default:!1},btnRound:{type:Boolean,default:!1},btnIcon:{type:String,default:"el-icon-upload2"},showBtnText:{type:Boolean,default:!0},btnText:{type:String,default:"上传附件"},showTip:{type:Boolean,default:!0}},data:function(){var e=this,t=Array.of.apply(Array,l);return this.businessFormat&&this.businessFormat.length>0&&(t=t.filter((function(t){return e.businessFormat.includes(t)}))),(!t||t.length<=0)&&(t=Array.of.apply(Array,l)),{action:"http://114.251.247.98/api".replace(/\/$/,"")+r["pfmcAsist"]+"/doc/up",headers:{Authorization:"Bearer "+Object(o["a"])()},whiteList:t,tipStr:t.join("、"),accept:"."+t.join(",."),maxSize:31457280,fileList:(this.defaultList||[]).map((function(e){return{url:e.documentId,name:e.documentName}})),busiId:this.businessId,fileLoading:!1,limitAttained:this.limit&&this.limit>0&&this.limit<=(this.defaultList||[]).length}},computed:{upldData:function(){var e={businessType:this.businessType};return this.businessCode&&(e.businessCode=this.businessCode),this.busiId&&(e.businessId=this.busiId),this.businessFormat&&this.businessFormat.length>0&&(e.businessFormat=this.businessFormat),e}},watch:{businessId:function(e,t){this.busiId=e,this.getFileData()}},created:function(){},mounted:function(){},methods:{setLimitAttained:function(){this.limitAttained=this.limit&&this.limit>0&&this.limit<=this.getFilesCount()},beforeUpload:function(e){var t=e.name.substring(e.name.lastIndexOf(".")+1),i=this.whiteList.includes(t);i||this.$notify.warning({title:"不允许的文件类型",message:"只能上传 ".concat(this.tipStr," 格式的文件!")});var n=e.size<=this.maxSize;return n||this.$notify.warning({title:"超出文件大小限制",message:"单个文件大小不能超过 ".concat(this.maxSize/1024/1024,"MB!")}),i&&n},handleSuccess:function(e,t,i){"0"===e.code?(this.busiId!==e.data.businessId&&(this.busiId=e.data.businessId,this.$emit("update-business-id",{newBusinessId:this.busiId,businessType:this.businessType,businessCode:this.businessCode,oldBusinessId:this.businessId})),t.url=e.data.documentId,this.setLimitAttained()):this.handleError(e.msg,t,i)},handleError:function(e,t,i){var n=this;if(this.$notify.error({title:t?t.name:"出错啦",message:"string"===typeof e?e:"上传附件出错。"}),console&&console.error(e),t&&i){var s=i.findIndex((function(e){return e.uid===t.uid}));s>=0&&i.splice(s,1)}this.$nextTick((function(){n.setLimitAttained()}))},beforeRemove:function(e,t){return!this.disabled&&this.$confirm("确定移除 ".concat(e.name,"？"))},handleRemove:function(e,t){var i=this;e&&e.url&&(this.fileLoading=!0,Object(a["deleteFile"])(e.url).then((function(t){"0"===t.code?(i.$message.success("删除成功！"),i.$emit("after-del",{businessId:i.busiId,businessCode:i.businessCode,businessType:i.businessType},e)):i.$notify.error({title:"服务调用异常",message:t.msg})})).catch((function(e){i.$notify.error({title:"网络错误",message:e.message})})).finally((function(){i.fileLoading=!1,i.$nextTick((function(){i.setLimitAttained()}))})))},handlePreview:function(e){var t=this;e&&e.url&&(this.fileLoading=!0,Object(a["downloadFile"])(e.url).then((function(e){var i=!e.headers["ihr-file-download-error"]&&e.headers["ihr-file-download-success"];if(i)Object(d["saveFile"])(e.data,e.headers["content-disposition"],e.headers["content-type"]);else{var n=e.headers["ihr-file-download-error"]||"";t.$notify.error({title:"服务调用异常",message:n})}})).catch((function(e){t.$notify.error({title:"网络错误",message:e.message})})).finally((function(){t.fileLoading=!1})))},handleExceed:function(e,t){this.$notify.warning({title:"超出文件个数限制",message:"当前限制选择 ".concat(this.limit," 个文件，本次选择了 ").concat(e.length," 个文件，共选择了 ").concat(e.length+t.length," 个文件")})},getFileData:function(){var e=this;this.fileList=[],this.setLimitAttained(),this.busiId&&(this.fileLoading=!0,Object(a["getFileList"])(this.businessType,this.businessCode,this.busiId).then((function(t){"0"===t.code?e.fileList=(t.data||[]).map((function(e){return{url:e.documentId,name:e.documentName}})):e.$notify.error({title:"服务调用异常",message:t.msg})})).catch((function(t){e.$notify.error({title:"网络错误",message:t.message})})).finally((function(){e.fileLoading=!1,e.setLimitAttained()})))},getFilesCount:function(){return(this.$refs.upld.uploadFiles||[]).length},getFiles:function(){return JSON.parse(JSON.stringify(this.$refs.upld.uploadFiles||[]))}}},c=u,f=i("2877"),h=Object(f["a"])(c,n,s,!1,null,null,null);t["default"]=h.exports},b854:function(e,t,i){"use strict";i.r(t),i.d(t,"pfmcSettings",(function(){return n})),i.d(t,"pfmcAsist",(function(){return s})),i.d(t,"pfmcExecution",(function(){return o})),i.d(t,"pfmcEval",(function(){return a}));var n="pfmc-settings",s="pfmc-asist",o="pfmc-execution",a="pfmc-eval"},e804:function(e,t,i){"use strict";var n=i("5ca1"),s=i("f1ae");n(n.S+n.F*i("79e5")((function(){function e(){}return!(Array.of.call(e)instanceof e)})),"Array",{of:function(){var e=0,t=arguments.length,i=new("function"==typeof this?this:Array)(t);while(t>e)s(i,e,arguments[e++]);return i.length=t,i}})},f792:function(e,t,i){"use strict";i.r(t),i.d(t,"saveFile",(function(){return o}));var n=i("7618");function s(e,t,i){if(null==e)return"";var o="",a=Object(n["a"])(e);if("string"==a||"number"==a||"boolean"==a)o+="&"+t+"="+(null==i||i?encodeURIComponent(e):e);else for(var r in e){var d=null==t?r:t+(e instanceof Array?"["+r+"]":"."+r);o+=s(e[r],d,i)}return o}var o=function(e,t,i){var n=new Blob([e],{type:i}),s=decodeURIComponent(t.substring(29));if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(n,s);else{var o=document.createElement("a"),a=window.URL.createObjectURL(n);o.href=a,o.download=s,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(a),document.body.removeChild(o)}};t["default"]={urlEncode:s,saveFile:o}}}]);