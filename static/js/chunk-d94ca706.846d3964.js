(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d94ca706","chunk-2d21062b","chunk-43456300","chunk-2d21062b","chunk-7ae718a6"],{1226:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pfmc-import-button-container"},[i("el-button",{attrs:{size:e.size,type:e.type,plain:e.plain,round:e.round,circle:e.circle,disabled:e.disabled,icon:e.icon},on:{click:function(t){e.showDialog=!0}}},[e._v(e._s(e.btnText))]),e._v(" "),i("el-dialog",{ref:"dialog",attrs:{visible:e.showDialog,title:e.title,"close-on-click-modal":!1,"append-to-body":"",width:"1000px"},on:{"update:visible":function(t){e.showDialog=t},opened:e.openDialog,close:e.handleCancel}},[i("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"测评问卷名称",prop:"questionName"}},[i("el-input",{staticStyle:{width:"44%"},attrs:{placeholder:"请输入..."},model:{value:e.form.questionName,callback:function(t){e.$set(e.form,"questionName",t)},expression:"form.questionName"}})],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"测评对象类型",prop:"evalObjectType"}},[i("el-select",{attrs:{placeholder:"请选择..."},model:{value:e.form.evalObjectType,callback:function(t){e.$set(e.form,"evalObjectType",t)},expression:"form.evalObjectType"}},e._l(e.evalOjbectTypeOptions,(function(e){return i("el-option",{key:e.dictValue,attrs:{label:e.dictLabel,value:e.dictValue}})})),1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"公开",prop:"isOpen"}},[i("el-radio-group",{model:{value:e.form.isOpen,callback:function(t){e.$set(e.form,"isOpen",t)},expression:"form.isOpen"}},[i("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),i("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1)],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"测评表单名称",prop:"formName"}},[i("el-input",{attrs:{placeholder:"请输入..."},model:{value:e.form.formName,callback:function(t){e.$set(e.form,"formName",t)},expression:"form.formName"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("div",{staticStyle:{margin:"6px 10px"}},[e._v("注:该名称为测评流程页面的评价表名")])])],1),e._v(" "),i("el-form-item",{attrs:{label:"评价说明",prop:"evalDesc"}},[i("el-input",{attrs:{type:"textarea",rows:"2",placeholder:"请输入..."},model:{value:e.form.evalDesc,callback:function(t){e.$set(e.form,"evalDesc",t)},expression:"form.evalDesc"}})],1),e._v(" "),i("div",{staticStyle:{float:"right"}},[i("el-button",{attrs:{type:"danger"}},[e._v("预览")]),e._v(" "),i("form-field-define",{attrs:{"field-list":e.form.formFieldList},on:{"define-finish":e.fieldDefineFinish}})],1),e._v(" "),i("el-table",{staticStyle:{width:"100%",background:"#f8f8f9 !important"},attrs:{data:[{}],"show-header":!1,"row-class-name":function(){return"row-color"}}},[i("el-table-column",{attrs:{width:"200"}},[[i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.append()}}},[e._v("增加")])]],2),e._v(" "),e._l(e.form.formFieldList,(function(t){return i("el-table-column",{key:t.viewName,attrs:{width:t.width,align:"center"}},[[i("b",[e._v(e._s(t.viewName))])]],2)}))],2),e._v(" "),i("el-tree",{ref:"tree",attrs:{data:e.form.formRowList,"node-key":"id","default-expand-all":"","expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,r=t.data;return i("span",{},[i("span",[i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.append(r)}}},[e._v("增加")]),e._v(" "),i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.remove(n,r)}}},[e._v("移除")])],1),e._v(" "),i("span",{staticStyle:{position:"absolute",left:"150px"}},[i("el-input",{staticStyle:{width:"150px"},model:{value:r.itemList[0].itemValue,callback:function(t){e.$set(r.itemList[0],"itemValue",t)},expression:"data.itemList[0].itemValue"}}),e._v(" "),i("el-input-number",{attrs:{disabled:r.children.length>0,max:r.children.length>0?200:100,controls:!1},on:{change:function(t){return e.wtChange(n)}},model:{value:r.itemList[1].itemValue,callback:function(t){e.$set(r.itemList[1],"itemValue",t)},expression:"data.itemList[1].itemValue"}}),e._v(" "),0===r.children.length?e._l(r.itemList.slice(2),(function(t){return i("el-input",{key:t.fieldId,style:"width:"+t.width+"px;margin:0 1px",attrs:{width:t.width,align:"center"},model:{value:t.itemValue,callback:function(i){e.$set(t,"itemValue",i)},expression:"e.itemValue"}})})):e._e()],2)])}}])})],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{plain:"",icon:"el-icon-close"},on:{click:e.handleCancel}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-bank-card"},on:{click:e.handleSave}},[e._v("保存")])],1)],1)],1)},r=[],o=(i("7514"),i("20d6"),i("ac6a"),i("9546")),a={name:"UpdateQuestion",components:{FormFieldDefine:function(){return i.e("chunk-6ce5a95c").then(i.bind(null,"e190"))}},props:{size:{type:String,default:"mini"},type:{type:String,default:"primary"},plain:{type:Boolean,default:!0},round:{type:Boolean,default:!1},circle:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},icon:{type:String,default:"el-icon-edit"},btnText:{type:String,default:"修改"},title:{type:String,default:"修改测评问卷"},isAdd:{type:Boolean,default:!1},questionId:{type:String,default:void 0}},data:function(){return{showDialog:!1,evalOjbectTypeOptions:[],form:{id:void 0,questionName:void 0,evalObjectType:"emp",isOpen:!0,formName:void 0,evalDesc:void 0,formFieldList:[{fieldId:1,showOrder:1,fieldName:"测评项目名称",viewName:"测评项目名称",width:150},{fieldId:2,showOrder:2,fieldName:"权重",viewName:"权重",width:100}],formRowList:[]},rules:{questionName:[{required:!0,message:"测评问卷名称不能为空",trigger:"change"}],evalObjectType:[{required:!0,message:"测评对象类型不能为空",trigger:"change"}],formName:[{required:!0,message:"测评表单名称不能为空",trigger:"change"}]},nodeId:0}},created:function(){var e=this;this.getDicts("pfmc_eval_object_type").then((function(t){e.evalOjbectTypeOptions=t.data}))},mounted:function(){},computed:{},methods:{openDialog:function(){this.$refs.form.clearValidate()},fieldDefineFinish:function(e){if(e.length>2)for(var t=Math.floor(500/(e.length-2)),i=2;i<e.length;i++)e[i].width=t;this.form.formFieldList=e,this.form.formRowList=[]},getLevelMaxOrder:function(e){return e.reduce((function(e,t){return t.showOrder>e?t.showOrder:e}),0)},append:function(e){var t={id:++this.nodeId,label:"",showOrder:0,children:[],itemList:[]};if(this.form.formFieldList.forEach((function(e){t.itemList.push({fieldId:e.fieldId,itemValue:"",width:e.width})})),!e){var i=this.getLevelMaxOrder(this.form.formRowList);return console.log("maxOrder111:"+i),t.showOrder=i+1,void this.form.formRowList.push(t)}var n=this.getLevelMaxOrder(e.children);console.log("maxOrder333:"+n),t.showOrder=n+1,e.children.push(t)},remove:function(e,t){var i=e.parent,n=i.data.children||i.data,r=n.findIndex((function(e){return e.id===t.id}));n.splice(r,1)},wtChange:function(e){if(1!==e.level){var t=e.parent,i=t.data.children||t.data,n=i.reduce((function(e,t){return e+t.itemList[1].itemValue}),0);t.data.itemList[1].itemValue=n,1!==t.level&&this.wtChange(t)}},handleSave:function(){var e=this;this.$refs.form.validate((function(t){if(t){var i=e.form.formRowList;if(0===i.length)return void e.msgError("测评项目不能为空");var n=i.reduce((function(e,t){return e+t.itemList[1].itemValue}),0);if(100!==n)return void e.msgError("权重总和不为100,请修改权重");for(var r=0;r<i.length;r++){var o=e.validateTestForm(i[r]);if("boolean"===typeof o&&!o)return}e.isAdd?e.addQuestionInfo(e.form):e.updateQuestionInfo(e.form)}}))},validateTestForm:function(e){var t=e.itemList,i=t.length;e.children.length>0&&i>2&&(i=2);for(var n=0;n<i;n++){var r=t[n];if(1===n&&!r.itemValue)return this.msgError("权重不能为0"),!1;if(!r.itemValue)return this.msgError("测评表单内容不能为空"),!1}if(e.children.length>0)for(var o=0;o<e.children.length;o++){var a=this.validateTestForm(e.children[o]);if("boolean"===typeof a&&!a)return!1}},handleSelectEmp:function(e){var t=this;e.forEach((function(e){t.form.memberList.find((function(t){return t.empId===e.empId}))||t.form.memberList.push({memberId:"0",groupId:t.groupId,empId:e.empId,empName:e.empName,isDeleted:!1})}))},addQuestionInfo:function(e){var t=this;Object(o["addQuestion"])(e).then((function(e){"0"===e.code?(t.msgSuccess("新增测评小组成功"),t.$emit("update-finish"),t.showDialog=!1):t.msgError(e.msg)}))},updateQuestionInfo:function(e){var t=this;updateQuestion(e).then((function(e){"0"===e.code?(t.msgSuccess("修改测评小组成功"),t.$emit("update-finish"),t.showDialog=!1):t.msgError(e.msg)}))},getOrgTreeselect:function(){var e=this;treeselect().then((function(t){e.orgOptions=t.data}))},handleFinish:function(){this.$emit("update-finish"),this.showDialog=!1},handleCancel:function(){this.resetForm(),this.showDialog=!1},resetForm:function(){this.form={id:void 0,questionName:void 0,evalObjectType:"emp",isOpen:!0,formName:void 0,evalDesc:void 0,formFieldList:[{fieldId:1,showOrder:1,fieldName:"测评项目名称",viewName:"测评项目名称",width:150},{fieldId:2,showOrder:2,fieldName:"权重",viewName:"权重",width:100}],formRowList:[]}}},watch:{}},l=a,c=(i("af21"),i("2877")),s=Object(c["a"])(l,n,r,!1,null,"604ccc0e",null);t["default"]=s.exports},7514:function(e,t,i){"use strict";var n=i("5ca1"),r=i("0a49")(5),o="find",a=!0;o in[]&&Array(1)[o]((function(){a=!1})),n(n.P+n.F*a,"Array",{find:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")(o)},9546:function(e,t,i){"use strict";i.r(t),i.d(t,"listGroup",(function(){return o})),i.d(t,"getGroupInfoById",(function(){return a})),i.d(t,"addQuestion",(function(){return l})),i.d(t,"updateGroup",(function(){return c})),i.d(t,"delGroup",(function(){return s})),i.d(t,"batchDelGroup",(function(){return d}));var n=i("b775"),r=i("b854");function o(e){return Object(n["a"])({url:"".concat(r["pfmcEval"],"/pfmcEvalGroup/listGroup"),method:"get",params:e})}function a(e){return Object(n["a"])({url:"".concat(r["pfmcEval"],"/pfmcEvalGroup/getGroupInfoById/").concat(e),method:"get"})}function l(e){return Object(n["a"])({url:"".concat(r["pfmcEval"],"/pfmcEvalQuestion/addQuestion"),method:"post",data:e})}function c(e){return Object(n["a"])({url:"".concat(r["pfmcEval"],"/pfmcEvalGroup/updateGroup"),method:"put",data:e})}function s(e){return Object(n["a"])({url:"".concat(r["pfmcEval"],"/pfmcEvalGroup/delGroup/").concat(e),method:"delete"})}function d(e){return Object(n["a"])({url:"".concat(r["pfmcEval"],"/pfmcEvalGroup/batchDelGroup"),method:"delete",data:e})}},af21:function(e,t,i){"use strict";var n=i("be6c"),r=i.n(n);r.a},b854:function(e,t,i){"use strict";i.r(t),i.d(t,"pfmcSettings",(function(){return n})),i.d(t,"pfmcAsist",(function(){return r})),i.d(t,"pfmcExecution",(function(){return o})),i.d(t,"pfmcEval",(function(){return a}));var n="pfmc-settings",r="pfmc-asist",o="pfmc-execution",a="pfmc-eval"},be6c:function(e,t,i){}}]);